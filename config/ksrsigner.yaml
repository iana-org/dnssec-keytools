---

# example ksrsigner configuration/policy file

# per HSM PKCS#11 configuration; module required, pin and env is optional
hsm:
  softhsm:
    module: /usr/local/homebrew/lib/softhsm/libsofthsm2.so
    pin: 123456
    env:
      SOFTHSM2_CONF: softhsm.conf
  aep:
    module: /usr/local/lib/pkcs11.GCC4.0.2.so.4.07
    pin: 123456
    so_pin: 123456
    env:
      KEYPER_LIBRARY_PATH: /var/dnssec/ksr/AEP

filenames:
  previous_skr: prev-skr.xml
  input_ksr: ksr.xml
  output_skr: skr.xml

# inventory of key signing keys
keys:
  ksk_current:
    description: Root DNSSEC KSK 2010
    label: Kjqmt7v
    key_tag: 19036
    algorithm: RSASHA256
    rsa_size: 2048
    rsa_exponent: 65537
    valid_from: 2010-07-15T00:00:00+00:00
    valid_until: 2019-01-11T00:00:00+00:00
    ds_sha256: 49AAC11D7B6F6446702E54A1607371607A1A41855200FD2CE1CDDE32F24E8FB5
  ksk_next:
    description: Root DNSSEC KSK 2017
    label: Klajeyz
    key_tag: 20326
    algorithm: RSASHA256
    rsa_size: 2048
    rsa_exponent: 65537
    valid_from: 2017-02-02T00:00:00+00:00
    ds_sha256: E06D44B80B8F1D39A95C0B0D7C65D08458E880409BBC683457104237C7F8EC8D

request_policy:
  # permitted domains in KSR
  acceptable_domains:
    - "."
  # number of bundles in KSR
  num_bundles: 9
  # validate ZSK proof-of-possession
  validate_signatures: true
  keys_match_zsk_policy: true
  rsa_exponent_match_zsk_policy: true
  check_bundle_overlap: true
  signature_validity_match_zsk_policy: true
  signature_algorithms_match_zsk_policy: true
  check_keys_match_ksk_operator_policy: true
  # number of unique ZSKs in request
  acceptable_key_set_lengths:
    - 2
    - 3
  # validate that the current request continues a timeline ending with the previous response
  check_request_daisy_chain: true
  approved_algorithms:
    - RSASHA256
  rsa_approved_exponents:
    - 3
    - 65537
  rsa_approved_key_sizes:
    - 2048

response_policy:
  num_bundles: 9
  validate_signatures: true

ksk_policy:
  publish_safety: PT0S
  retire_safety: P28D
  max_signature_validity: P21D
  min_signature_validity: P21D
  max_validity_overlap: P16D
  min_validity_overlap: P9D
  ttl: 172800

# SKR signature schemes, each scheme defines what
#
schemas:

  # normal key bundle
  normal:
    1:
      publish: ksk_current
      sign: ksk_current
    2:
      publish: ksk_current
      sign: ksk_current
    3:
      publish: ksk_current
      sign: ksk_current
    4:
      publish: ksk_current
      sign: ksk_current
    5:
      publish: ksk_current
      sign: ksk_current
    6:
      publish: ksk_current
      sign: ksk_current
    7:
      publish: ksk_current
      sign: ksk_current
    8:
      publish: ksk_current
      sign: ksk_current
    9:
      publish: ksk_current
      sign: ksk_current

  # introduce (pre-publish) the next KSK in slot 2-9 (phase D)
  pre-publish:
    1:
      publish: ksk_current
      sign: ksk_current
    2:
      publish:
        - ksk_current
        - ksk_next
      sign: ksk_current
    3:
      publish:
        - ksk_current
        - ksk_next
      sign: ksk_current
    4:
      publish:
        - ksk_current
        - ksk_next
      sign: ksk_current
    5:
      publish:
        - ksk_current
        - ksk_next
      sign: ksk_current
    6:
      publish:
        - ksk_current
        - ksk_next
      sign: ksk_current
    7:
      publish:
        - ksk_current
        - ksk_next
      sign: ksk_current
    8:
      publish:
        - ksk_current
        - ksk_next
      sign: ksk_current
    9:
      publish:
        - ksk_current
        - ksk_next
      sign: ksk_current

  # roll over from the current to the next KSK (phase E)
  rollover:
    1:
      publish:
        - ksk_current
        - ksk_next
      sign: ksk_current
    2:
      publish:
        - ksk_current
        - ksk_next
      sign: ksk_next
    3:
      publish:
        - ksk_current
        - ksk_next
      sign: ksk_next
    4:
      publish:
        - ksk_current
        - ksk_next
      sign: ksk_next
    5:
      publish:
        - ksk_current
        - ksk_next
      sign: ksk_next
    6:
      publish:
        - ksk_current
        - ksk_next
      sign: ksk_next
    7:
      publish:
        - ksk_current
        - ksk_next
      sign: ksk_next
    8:
      publish:
        - ksk_current
        - ksk_next
      sign: ksk_next
    9:
      publish:
        - ksk_current
        - ksk_next
      sign: ksk_next

  # published the previous KSK as revoked during slot 2-8 (phase F)
  revoke:
    1:
      publish:
        - ksk_current
        - ksk_next
      sign: ksk_next
    2:
      publish: ksk_next
      revoke: ksk_current
      sign:
        - ksk_current
        - ksk_next
    3:
      publish: ksk_next
      revoke: ksk_current
      sign:
        - ksk_current
        - ksk_next
    4:
      publish: ksk_next
      revoke: ksk_current
      sign:
        - ksk_current
        - ksk_next
    5:
      publish: ksk_next
      revoke: ksk_current
      sign:
        - ksk_current
        - ksk_next
    6:
      publish: ksk_next
      revoke: ksk_current
      sign:
        - ksk_current
        - ksk_next
    7:
      publish: ksk_next
      revoke: ksk_current
      sign:
        - ksk_current
        - ksk_next
    8:
      publish: ksk_next
      revoke: ksk_current
      sign:
        - ksk_current
        - ksk_next
    9:
      publish: ksk_next
      sign: ksk_next

  # stay in publication (extend phase D)
  publish+:
    1:
      publish:
        - ksk_current
        - ksk_next
      sign: ksk_current
    2:
      publish:
        - ksk_current
        - ksk_next
      sign: ksk_current
    3:
      publish:
        - ksk_current
        - ksk_next
      sign: ksk_current
    4:
      publish:
        - ksk_current
        - ksk_next
      sign: ksk_current
    5:
      publish:
        - ksk_current
        - ksk_next
      sign: ksk_current
    6:
      publish:
        - ksk_current
        - ksk_next
      sign: ksk_current
    7:
      publish:
        - ksk_current
        - ksk_next
      sign: ksk_current
    8:
      publish:
        - ksk_current
        - ksk_next
      sign: ksk_current
    9:
      publish:
        - ksk_current
        - ksk_next
      sign: ksk_current

  # stay in rollover (extend phase E)
  rollover+:
    1:
      publish:
        - ksk_current
        - ksk_next
      sign: ksk_next
    2:
      publish:
        - ksk_current
        - ksk_next
      sign: ksk_next
    3:
      publish:
        - ksk_current
        - ksk_next
      sign: ksk_next
    4:
      publish:
        - ksk_current
        - ksk_next
      sign: ksk_next
    5:
      publish:
        - ksk_current
        - ksk_next
      sign: ksk_next
    6:
      publish:
        - ksk_current
        - ksk_next
      sign: ksk_next
    7:
      publish:
        - ksk_current
        - ksk_next
      sign: ksk_next
    8:
      publish:
        - ksk_current
        - ksk_next
      sign: ksk_next
    9:
      publish:
        - ksk_current
        - ksk_next
      sign: ksk_next

    # stay in revocation (extend phase F)
    revoke+:
      1:
        publish: ksk_next
        sign: ksk_next
      2:
        publish: ksk_next
        revoke: ksk_current
        sign:
          - ksk_current
          - ksk_next
      3:
        publish: ksk_next
        revoke: ksk_current
        sign:
          - ksk_current
          - ksk_next
      4:
        publish: ksk_next
        revoke: ksk_current
        sign:
          - ksk_current
          - ksk_next
      5:
        publish: ksk_next
        revoke: ksk_current
        sign:
          - ksk_current
          - ksk_next
      6:
        publish: ksk_next
        revoke: ksk_current
        sign:
          - ksk_current
          - ksk_next
      7:
        publish: ksk_next
        revoke: ksk_current
        sign:
          - ksk_current
          - ksk_next
      8:
        publish: ksk_next
        revoke: ksk_current
        sign:
          - ksk_current
          - ksk_next
      9:
        publish: ksk_next
        sign: ksk_next
