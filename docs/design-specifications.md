# Architectural Design and Functional Specification

Figure 1 outlines the high-level architectural design of the KSR Signer software,
describing the security domains and functions maintained by the software.

![Figure 1: Architectural overview of the KSR Signer software][figure1]

[figure1]: ksr-signer.svg "Architectural overview of the KSR Signer software"

## Design

The Key Management Tools consists of the following two critical core components:

-   **KSK Generator**
-   **KSR Signer**

All critical components interact with the user via the UNIX command line interface
and uses vendor provided PKCS#11 libraries to communicate with any cryptographic
modules.

There is a utility component named **Webservice KSR/SKR Processor** that is not
critical and not described in Figure 1 since is not using during the KSK
ceremonies.

### KSK Generator

The KSK Generator generates a KSK inside an HSM.
Fingerprint and keytag of the public key is returned to the user.

#### Key Generation Handler

The process of generating a new key involves the validation of the key parameters,
successful processing of key generation requests in the HSM, the output of the fingerprint
and keytag of the new KSK.

The Key Generation Handler is responsible for receiving the Key Generation Request,
coordinating those various functions with the Key Parameters Validator, the HSM
via the PKCS#11 library, and returning appropriate success or failure indications
to the user with other information about the generated KSK as described above.

#### Key Parameters Validator

The Key Parameters Validator ensures that the key generation is well-formed,
internally-consistent and is syntactically correct.

Key Parameters Validator ensure that when a new KSK is generated the key id (a.k.a. keytag)
and keylabel are not equal to any previously generated key.

#### Trust Anchor Export Handler

#### Trust Anchor Assembler

### KSR Signer

The KSR Signer will validate a Key Signing Request (KSR), generate signatures to
be used in the root zone as RRSIGs over the apex DNSKEY RRSet as requested in the
KSR and output the result as a Signed Key Response (SKR).
The KSR Signer will generate signatures using one or more KSKs available on attached
HSMs according to the Signing Policy Configuration.

#### Key Signing Request (KSR)

A KSR is supplied by the Root Zone Maintainer for processing as an XML document.
The KSR specifies a set of time intervals together with the DNSKEY RDATA relating
to the ZSKs that will be used during each of them.
Every key bundle is signed using every included ZSK as proof of possession of the
corresponding private key.

The SKR that was generated by the processing of the immediately preceding KSR
(usually at the previous KSK Ceremony) is also supplied to the KSR Signer,
in order that various consistency checks can be carried out.

#### KSR Processing Handler

The processing of a KSR involves successful confirmation that the KSR being processed
is well-formed, is syntactically-correct, internally-consistent and does not violate
the constraints specified in the Signing Policy Configuration (for example, a KSR
should not be allowed to request a signature with a validity period in the past,
or too far in the future). Also verifies that the KSR is compatible with the SKR
produced during the previous KSK Ceremony, for the previously-submitted KSR.
Then the construction of DNSKEY RRSets that include the relevant ZSKs and KSKs
to be published during each time interval, the generation of signatures over those
RRSets by the RRSet Signer and the construction of a corresponding SKR.

#### RRSet Signer

The RRSet Signer generates signatures over a supplied DNSKEY RRSet using one or
more KSKs specified in the Signing Policy Configuration. It uses the PKCS#11
interface to the local HSM to carry out signing functions.

#### Signed Key Response (SKR)

The SKR is the product of the RRSet Signer. The KSR Processing Handler constructs
an SKR from the KSR being processed and the signed RRSets constructed by the RRSet
Signer. The result is stored in a file as well-formed XML consistent with and
validated against the SKR schema.

It is delivered as a single file suitable for delivery to the Root Zone Maintainer.

#### Signing Policy Configuration

The Signing Policy Configuration provides the parameters necessary for KSR processing.

### Webservice KSR/SKR Processor

The KSR/SKR Processor receives a KSR from an authorized client (operated by the
Root Zone Maintainer) over a secure network channel (HTTP over TLS with client
authentication), provides validation of the KSR (such as integrity, parameters,
and validation of the previous SKR) to provide a useful, real-time response to
the client, and generates notification when a KSR has been submitted.
